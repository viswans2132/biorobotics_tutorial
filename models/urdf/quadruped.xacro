<?xml version="1.0"?>

<robot name="quadruped" xmlns:xacro="http://ros.org/wiki/xacro">

  <xacro:property name="namespace" value="robot" />
  <xacro:property name="mass" value="0.01" />
  <!-- <xacro:property name="pi" value="3.14159" /> -->

  <!-- Macro for the inertia of a box -->
  <xacro:macro name="box_inertia" params="x y z mass">
    <inertia ixx="${0.0833333 * mass * (y*y + z*z)}" ixy="0.0" ixz="0.0"
      iyy="${0.0833333 * mass * (x*x + z*z)}" iyz="0.0"
      izz="${0.0833333 * mass * (x*x + y*y)}" />
  </xacro:macro>

    <!-- Macro for the inertial properties of a box -->
  <xacro:macro name="box_inertial" params="x y z mass *origin">
    <inertial>
      <mass value="${mass}" />
      <xacro:insert_block name="origin" />
      <xacro:box_inertia x="${x}" y="${y}" z="${z}" mass="${mass}" />
    </inertial>
  </xacro:macro>

  <!-- Macro for the inertia of a ellipsoid -->
  <xacro:macro name="ellipsoid_inertia" params="radius mass">
    <inertia ixx="${0.4 * mass * radius * radius}" ixy="0.0" ixz="0.0"
      iyy="${0.4 * mass * radius * radius}" iyz="0.0"
      izz="${0.4 * mass * radius * radius}" />
  </xacro:macro>

    <!-- Macro for the inertial properties of a ellipsoid -->
  <xacro:macro name="ellipsoid_inertial" params="radius mass *origin">
    <inertial>
      <mass value="${mass}" />
      <xacro:insert_block name="origin" />
      <xacro:ellipsoid_inertia radius="${radius}" mass="${mass}" />
    </inertial>
  </xacro:macro>

  <link name="${namespace}/base_link" >
    <visual>
      <origin xyz="0 0 0" />
      <geometry>
        <box size="0.0 0.0 0.0" />
      </geometry>
    </visual>
  </link>

  <link name="${namespace}/body">
    <xacro:box_inertial x="0.6" y="0.3" z="0.15" mass="1.1">
      <origin xyz="0 0 0" />
    </xacro:box_inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.6 0.3 0.15"/> 
      </geometry>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.6 0.3 0.15"/> 
       </geometry>
    </collision>
  </link>

  <link name="${namespace}/front_left_thigh">
    <xacro:box_inertial x="0.25" y="0.05" z="0.05" mass="0.5">
      <origin xyz="0.1 0 0" />
    </xacro:box_inertial>
    <visual>
      <origin xyz="0.1 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.25 0.05 0.05"/> 
      </geometry>
    </visual>
    <collision>
      <origin xyz="0.1 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.25 0.05 0.05"/> 
       </geometry>
    </collision>
  </link>



  <link name="${namespace}/front_left_lower_leg">
    <xacro:box_inertial x="0.25" y="0.05" z="0.05" mass="0.5">
      <origin xyz="0.1 0 0" />
    </xacro:box_inertial>
    <visual>
      <origin xyz="0.1 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.25 0.05 0.05"/> 
      </geometry>
    </visual>
    <collision>
      <origin xyz="0.1 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.25 0.05 0.05"/> 
       </geometry>
    </collision>
  </link>



  <link name="${namespace}/front_right_thigh">
    <xacro:box_inertial x="0.25" y="0.05" z="0.05" mass="0.5">
      <origin xyz="0.1 0 0" />
    </xacro:box_inertial>
    <visual>
      <origin xyz="0.1 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.25 0.05 0.05"/> 
      </geometry>
    </visual>
    <collision>
      <origin xyz="0.1 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.25 0.05 0.05"/> 
       </geometry>
    </collision>
  </link>



  <link name="${namespace}/front_right_lower_leg">
    <xacro:box_inertial x="0.25" y="0.05" z="0.05" mass="0.5">
      <origin xyz="0.1 0 0" />
    </xacro:box_inertial>
    <visual>
      <origin xyz="0.1 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.25 0.05 0.05"/> 
      </geometry>
    </visual>
    <collision>
      <origin xyz="0.1 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.25 0.05 0.05"/> 
       </geometry>
    </collision>
  </link>


  <link name="${namespace}/rear_left_thigh">
    <xacro:box_inertial x="0.25" y="0.05" z="0.05" mass="0.5">
      <origin xyz="0.1 0 0" />
    </xacro:box_inertial>
    <visual>
      <origin xyz="0.1 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.25 0.05 0.05"/> 
      </geometry>
    </visual>
    <collision>
      <origin xyz="0.1 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.25 0.05 0.05"/> 
       </geometry>
    </collision>
  </link>


  <link name="${namespace}/rear_left_lower_leg">
    <xacro:box_inertial x="0.25" y="0.05" z="0.05" mass="0.5">
      <origin xyz="0.1 0 0" />
    </xacro:box_inertial>
    <visual>
      <origin xyz="0.1 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.25 0.05 0.05"/> 
      </geometry>
    </visual>
    <collision>
      <origin xyz="0.1 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.25 0.05 0.05"/> 
       </geometry>
    </collision>
  </link>


  <link name="${namespace}/rear_right_thigh">
    <xacro:box_inertial x="0.25" y="0.05" z="0.05" mass="0.5">
      <origin xyz="0.1 0 0" />
    </xacro:box_inertial>
    <visual>
      <origin xyz="0.1 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.25 0.05 0.05"/> 
      </geometry>
    </visual>
    <collision>
      <origin xyz="0.1 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.25 0.05 0.05"/> 
       </geometry>
    </collision>
  </link>



  <link name="${namespace}/rear_right_lower_leg">
    <xacro:box_inertial x="0.25" y="0.05" z="0.05" mass="0.5">
      <origin xyz="0.1 0 0" />
    </xacro:box_inertial>
    <visual>
      <origin xyz="0.1 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.25 0.05 0.05"/> 
      </geometry>
    </visual>
    <collision>
      <origin xyz="0.1 0 0" rpy="0 0 0" />
      <geometry>
        <box size="0.25 0.05 0.05"/> 
       </geometry>
    </collision>
  </link>



  <link name="${namespace}/rear_right_ball">
    <xacro:ellipsoid_inertial radius="0.025" mass="0.1">
      <origin xyz="0 0 0" />
    </xacro:ellipsoid_inertial>
    <visual>
      <origin xyz="0.0 0 0" rpy="0 0 0" />
      <geometry>
        <sphere radius="0.025"/> 
      </geometry>
    </visual>
    <collision>
      <origin xyz="0.0 0 0" rpy="0 0 0" />
      <geometry>
        <sphere radius="0.025"/> 
       </geometry>
       <surface>
          <friction>
            <ode>
              <mu>4.01</mu>
              <mu2>10.01</mu2>
            </ode>
          </friction>
        </surface>
    </collision>
  </link>

  <link name="${namespace}/rear_left_ball">
    <xacro:ellipsoid_inertial radius="0.025" mass="0.1">
      <origin xyz="0 0 0" />
    </xacro:ellipsoid_inertial>
    <visual>
      <origin xyz="0.0 0 0" rpy="0 0 0" />
      <geometry>
        <sphere radius="0.025"/> 
      </geometry>
    </visual>
    <collision>
      <origin xyz="0.0 0 0" rpy="0 0 0" />
      <geometry>
        <sphere radius="0.025"/> 
       </geometry>
       <surface>
          <friction>
            <ode>
              <mu>4.01</mu>
              <mu2>10.01</mu2>
            </ode>
          </friction>
        </surface>
    </collision>
  </link>

  <link name="${namespace}/front_left_ball">
    <xacro:ellipsoid_inertial radius="0.025" mass="0.1">
      <origin xyz="0 0 0" />
    </xacro:ellipsoid_inertial>
    <visual>
      <origin xyz="0.0 0 0" rpy="0 0 0" />
      <geometry>
        <sphere radius="0.025"/> 
      </geometry>
    </visual>
    <collision>
      <origin xyz="0.0 0 0" rpy="0 0 0" />
      <geometry>
        <sphere radius="0.025"/> 
       </geometry>
       <surface>
          <friction>
            <ode>
              <mu>4.01</mu>
              <mu2>10.01</mu2>
            </ode>
          </friction>
        </surface>
    </collision>
  </link>

  <link name="${namespace}/front_right_ball">
    <xacro:ellipsoid_inertial radius="0.025" mass="0.1">
      <origin xyz="0 0 0" />
    </xacro:ellipsoid_inertial>
    <visual>
      <origin xyz="0.0 0 0" rpy="0 0 0" />
      <geometry>
        <sphere radius="0.025"/> 
      </geometry>
    </visual>
    <collision>
      <origin xyz="0.0 0 0" rpy="0 0 0" />
      <geometry>
        <sphere radius="0.025"/> 
       </geometry>
       <surface>
          <friction>
            <ode>
              <mu>4.01</mu>
              <mu2>10.01</mu2>
            </ode>
          </friction>
        </surface>
    </collision>
  </link>



  <joint name="${namespace}/base_joint" type="fixed">
    <origin xyz="0.0 0 0.0" rpy="0 0 0" />
    <parent link="${namespace}/base_link" />
    <child link="${namespace}/body" />
  </joint>

  <joint name="${namespace}/front_left_hip" type="revolute">
    <origin xyz="0.25 0.175 0.0" rpy="0.0 0.0 0 " />
    <parent link="${namespace}/body" />
    <child link="${namespace}/front_left_thigh" />
      <axis xyz="0 1 0" />
      <limit lower="${-pi}" upper="${pi}" effort="50" velocity="1" />
  </joint>

  <joint name="${namespace}/front_left_knee" type="revolute">
    <origin xyz="0.2 0.05 0.0" rpy="0 ${pi} 0" />
    <parent link="${namespace}/front_left_thigh" />
    <child link="${namespace}/front_left_lower_leg" />
      <axis xyz="0 1 0" />
      <limit lower="${-pi}" upper="${pi}" effort="50" velocity="1" />
  </joint>


  <joint name="${namespace}/front_right_hip" type="revolute">
    <origin xyz="0.25 -0.175 0.0" rpy="0.0 0.0 0 " />
    <parent link="${namespace}/body" />
    <child link="${namespace}/front_right_thigh" />
      <axis xyz="0 1 0" />
      <limit lower="${-pi}" upper="${pi}" effort="50" velocity="1" />
  </joint>

  <joint name="${namespace}/front_right_knee" type="revolute">
    <origin xyz="0.2 -0.05 0.0" rpy="0 ${pi} 0" />
    <parent link="${namespace}/front_right_thigh" />
    <child link="${namespace}/front_right_lower_leg" />
      <axis xyz="0 1 0" />
      <limit lower="${-pi}" upper="${pi}" effort="50" velocity="1" />
  </joint>

  <joint name="${namespace}/rear_left_hip" type="revolute">
    <origin xyz="-0.25 0.175 0.0" rpy="0.0 ${pi} 0 " />
    <parent link="${namespace}/body" />
    <child link="${namespace}/rear_left_thigh" />
      <axis xyz="0 -1 0" />
      <limit lower="${-pi}" upper="${pi}" effort="50" velocity="1" />
  </joint>

  <joint name="${namespace}/rear_left_knee" type="revolute">
    <origin xyz="0.2 0.05 0.0" rpy="0 ${pi} 0" />
    <parent link="${namespace}/rear_left_thigh" />
    <child link="${namespace}/rear_left_lower_leg" />
      <axis xyz="0 -1 0" />
      <limit lower="${-pi}" upper="${pi}" effort="50" velocity="1" />
  </joint>


  <joint name="${namespace}/rear_right_hip" type="revolute">
    <origin xyz="-0.25 -0.175 0.0" rpy="0.0 ${pi} 0 " />
    <parent link="${namespace}/body" />
    <child link="${namespace}/rear_right_thigh" />
      <axis xyz="0 -1 0" />
      <limit lower="${-pi}" upper="${pi}" effort="50" velocity="1" />
  </joint>

  <joint name="${namespace}/rear_right_knee" type="revolute">
    <origin xyz="0.2 -0.05 0.0" rpy="0 ${pi} 0" />
    <parent link="${namespace}/rear_right_thigh" />
    <child link="${namespace}/rear_right_lower_leg" />
      <axis xyz="0 -1 0" />
      <limit lower="${-pi}" upper="${pi}" effort="50" velocity="1" />
  </joint>


  <joint name="${namespace}/front_right_ankle" type="fixed">
    <origin xyz="0.225 -0.0 0.0" rpy="0 0 0" />
    <parent link="${namespace}/front_right_lower_leg" />
    <child link="${namespace}/front_right_ball" />
  </joint>
  <joint name="${namespace}/front_left_ankle" type="fixed">
    <origin xyz="0.225 -0.0 0.0" rpy="0 0 0" />
    <parent link="${namespace}/front_left_lower_leg" />
    <child link="${namespace}/front_left_ball" />
  </joint>


  <joint name="${namespace}/rear_right_ankle" type="fixed">
    <origin xyz="0.225 -0.0 0.0" rpy="0 0 0" />
    <parent link="${namespace}/rear_right_lower_leg" />
    <child link="${namespace}/rear_right_ball" />
  </joint>
  <joint name="${namespace}/rear_left_ankle" type="fixed">
    <origin xyz="0.225 -0.0 0.0" rpy="0 0 0" />
    <parent link="${namespace}/rear_left_lower_leg" />
    <child link="${namespace}/rear_left_ball" />
  </joint>


  <!-- Interface the plugin with the movable joints -->
  <ros2_control name="GazeboSystem" type="system">
    <hardware>
      <plugin>gazebo_ros2_control/GazeboSystem</plugin>
    </hardware>
    <joint name="${namespace}/front_right_hip">
      <param name="pos_kp">20</param>
      <param name="pos_ki">0.5</param>
      <param name="pos_kd">1</param>
      <param name="pos_max_integral_error">1</param>
      <command_interface name="position_pid"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
    <joint name="${namespace}/front_left_hip">
      <param name="pos_kp">20</param>
      <param name="pos_ki">0.5</param>
      <param name="pos_kd">1</param>
      <param name="pos_max_integral_error">1</param>
      <command_interface name="position_pid"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
    <joint name="${namespace}/front_right_knee">
      <param name="pos_kp">10</param>
      <param name="pos_ki">0.5</param>
      <param name="pos_kd">1</param>
      <param name="pos_max_integral_error">1</param>
      <command_interface name="position_pid"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
    <joint name="${namespace}/front_left_knee">
      <param name="pos_kp">10</param>
      <param name="pos_ki">0.5</param>
      <param name="pos_kd">1</param>
      <param name="pos_max_integral_error">1</param>
      <command_interface name="position_pid"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
    <joint name="${namespace}/rear_right_hip">
      <param name="pos_kp">20</param>
      <param name="pos_ki">0.5</param>
      <param name="pos_kd">1</param>
      <param name="pos_max_integral_error">1</param>
      <command_interface name="position_pid"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
    <joint name="${namespace}/rear_left_hip">
      <param name="pos_kp">20</param>
      <param name="pos_ki">0.5</param>
      <param name="pos_kd">1</param>
      <param name="pos_max_integral_error">1</param>
      <command_interface name="position_pid"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
    <joint name="${namespace}/rear_right_knee">
      <param name="pos_kp">10</param>
      <param name="pos_ki">0.5</param>
      <param name="pos_kd">1</param>
      <param name="pos_max_integral_error">1</param>
      <command_interface name="position_pid"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
    <joint name="${namespace}/rear_left_knee">
      <param name="pos_kp">10</param>
      <param name="pos_ki">0.5</param>
      <param name="pos_kd">1</param>
      <param name="pos_max_integral_error">1</param>
      <command_interface name="position_pid"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
  </ros2_control>

  <gazebo>
    <plugin filename="libgazebo_ros2_control.so" name="gazebo_ros2_control">
      <parameters>$(find biorobotics_tutorial)/models/quadruped_config.yaml</parameters>
    </plugin>
  </gazebo>


  <gazebo reference="${namespace}/front_left_thigh">
    <material>Gazebo/Grey</material> 
      <mu1>10.01</mu1>
      <mu2>1.01</mu2>
  </gazebo>

  <gazebo reference="${namespace}/front_right_thigh">
    <material>Gazebo/Grey</material> 
      <mu1>10.01</mu1>
      <mu2>1.01</mu2>
  </gazebo>

  <gazebo reference="${namespace}/rear_left_thigh">
    <material>Gazebo/Grey</material> 
      <mu1>10.01</mu1>
      <mu2>1.01</mu2>
  </gazebo>

  <gazebo reference="${namespace}/rear_right_thigh">
    <material>Gazebo/Grey</material> 
      <mu1>10.01</mu1>
      <mu2>1.01</mu2>
  </gazebo>

  <gazebo reference="${namespace}/front_left_lower_leg">
    <material>Gazebo/Grey</material> 
      <mu1>10.01</mu1>
      <mu2>1.01</mu2>
  </gazebo>

  <gazebo reference="${namespace}/front_right_lower_leg">
    <material>Gazebo/Grey</material> 
      <mu1>10.01</mu1>
      <mu2>1.01</mu2>
  </gazebo>

  <gazebo reference="${namespace}/rear_left_lower_leg">
    <material>Gazebo/Grey</material> 
      <mu1>10.01</mu1>
      <mu2>1.01</mu2>
  </gazebo>

  <gazebo reference="${namespace}/rear_right_lower_leg">
    <material>Gazebo/Grey</material> 
      <mu1>10.01</mu1>
      <mu2>1.01</mu2>
  </gazebo>

  <gazebo reference="${namespace}/body">
    <material>Gazebo/Yellow</material> 
      <mu1>150.01</mu1>
      <mu2>150.01</mu2>
  </gazebo>



  <gazebo reference="${namespace}/front_left_ball">
    <material>Gazebo/Orange</material> 
      <mu1>40.01</mu1>
      <mu2>10.01</mu2>
  </gazebo>

  <gazebo reference="${namespace}/front_right_ball">
    <material>Gazebo/Orange</material> 
      <mu1>40.01</mu1>
      <mu2>10.01</mu2>
  </gazebo>

  <gazebo reference="${namespace}/rear_left_ball">
    <material>Gazebo/Orange</material> 
      <mu1>40.01</mu1>
      <mu2>10.01</mu2>
  </gazebo>

  <gazebo reference="${namespace}/rear_right_ball">
    <material>Gazebo/Orange</material> 
      <mu1>40.01</mu1>
      <mu2>10.01</mu2>
  </gazebo>




</robot>